---
import Layout from '../layouts/Layout.astro';
import { Icon } from 'astro-icon/components';
---

<Layout 
  title="Book a Demo - Payflo Payroll Infrastructure"
  description="Schedule a demo to see how Payflo can help you add payroll capabilities to your platform."
>
  <div class="min-h-screen bg-gradient-to-b from-payflo-gray/50 to-white py-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4">Book a Demo</h1>
        <p class="text-xl text-gray-600">
          See how Payflo can help you add payroll capabilities to your platform
        </p>
      </div>

      <!-- Multi-step Form -->
      <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
        <!-- Progress Steps -->
        <div class="flex border-b border-gray-100" id="progress-steps">
          <div class="flex-1 p-4 text-center bg-payflo-purple/5 border-r border-gray-100 current-step" data-step="1">
            <div class="flex items-center justify-center mb-2">
              <div class="w-8 h-8 rounded-full bg-payflo-purple text-white flex items-center justify-center">
                <span>1</span>
              </div>
            </div>
            <span class="text-sm font-medium">Company Info</span>
          </div>
          <div class="flex-1 p-4 text-center border-r border-gray-100" data-step="2">
            <div class="flex items-center justify-center mb-2">
              <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center">
                <span>2</span>
              </div>
            </div>
            <span class="text-sm font-medium">Contact Details</span>
          </div>
          <div class="flex-1 p-4 text-center" data-step="3">
            <div class="flex items-center justify-center mb-2">
              <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center">
                <span>3</span>
              </div>
            </div>
            <span class="text-sm font-medium">Schedule Demo</span>
          </div>
        </div>

        <!-- Form Steps -->
        <form id="demo-form" class="p-8">
          <!-- Step 1: Company Info -->
          <div class="step-content" id="step-1">
            <div class="space-y-6">
              <div>
                <label for="company" class="block text-sm font-medium text-gray-700 mb-1">
                  Company Name
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Your company name"
                />
              </div>

              <div>
                <label for="website" class="block text-sm font-medium text-gray-700 mb-1">
                  Company Website
                </label>
                <input
                  type="url"
                  id="website"
                  name="website"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="https://"
                />
              </div>

              <div>
                <label for="company-size" class="block text-sm font-medium text-gray-700 mb-1">
                  Company Size
                </label>
                <select
                  id="company-size"
                  name="company-size"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                >
                  <option value="">Select company size</option>
                  <option value="1-10">1-10 employees</option>
                  <option value="11-50">11-50 employees</option>
                  <option value="51-200">51-200 employees</option>
                  <option value="201-500">201-500 employees</option>
                  <option value="501+">501+ employees</option>
                </select>
              </div>

              <div>
                <label for="industry" class="block text-sm font-medium text-gray-700 mb-1">
                  Industry
                </label>
                <select
                  id="industry"
                  name="industry"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                >
                  <option value="">Select industry</option>
                  <option value="hr-software">HR Software</option>
                  <option value="workforce-management">Workforce Management</option>
                  <option value="time-tracking">Time Tracking</option>
                  <option value="erp">ERP</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Step 2: Contact Details -->
          <div class="step-content hidden" id="step-2">
            <div class="space-y-6">
              <div class="grid grid-cols-2 gap-6">
                <div>
                  <label for="first-name" class="block text-sm font-medium text-gray-700 mb-1">
                    First Name
                  </label>
                  <input
                    type="text"
                    id="first-name"
                    name="first-name"
                    required
                    class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  />
                </div>
                <div>
                  <label for="last-name" class="block text-sm font-medium text-gray-700 mb-1">
                    Last Name
                  </label>
                  <input
                    type="text"
                    id="last-name"
                    name="last-name"
                    required
                    class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  />
                </div>
              </div>

              <div>
                <label for="work-email" class="block text-sm font-medium text-gray-700 mb-1">
                  Work Email
                </label>
                <input
                  type="email"
                  id="work-email"
                  name="work-email"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="you@company.com"
                />
              </div>

              <div>
                <label for="job-title" class="block text-sm font-medium text-gray-700 mb-1">
                  Job Title
                </label>
                <input
                  type="text"
                  id="job-title"
                  name="job-title"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                />
              </div>

              <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
                  Phone Number
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Optional"
                />
              </div>
            </div>
          </div>

          <!-- Step 3: Schedule Demo -->
          <div class="step-content hidden" id="step-3">
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Preferred Demo Date
                </label>
                <div class="grid grid-cols-3 gap-4">
                  <button
                    type="button"
                    class="px-4 py-3 rounded-lg border border-gray-200 hover:border-payflo-purple hover:bg-payflo-purple/5 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20"
                    data-date="tomorrow"
                  >
                    Tomorrow<br>
                    <span class="text-sm text-gray-500">10:00 AM</span>
                  </button>
                  <button
                    type="button"
                    class="px-4 py-3 rounded-lg border border-gray-200 hover:border-payflo-purple hover:bg-payflo-purple/5 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20"
                    data-date="day-after"
                  >
                    Day After<br>
                    <span class="text-sm text-gray-500">2:00 PM</span>
                  </button>
                  <button
                    type="button"
                    class="px-4 py-3 rounded-lg border border-gray-200 hover:border-payflo-purple hover:bg-payflo-purple/5 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20"
                    data-date="custom"
                  >
                    Custom Date<br>
                    <span class="text-sm text-gray-500">Choose Time</span>
                  </button>
                </div>
              </div>

              <div>
                <label for="timezone" class="block text-sm font-medium text-gray-700 mb-1">
                  Your Timezone
                </label>
                <select
                  id="timezone"
                  name="timezone"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                >
                  <option value="America/New_York">Eastern Time (ET)</option>
                  <option value="America/Chicago">Central Time (CT)</option>
                  <option value="America/Denver">Mountain Time (MT)</option>
                  <option value="America/Los_Angeles">Pacific Time (PT)</option>
                </select>
              </div>

              <div>
                <label for="message" class="block text-sm font-medium text-gray-700 mb-1">
                  Additional Information
                </label>
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-payflo-purple/20 focus:border-payflo-purple"
                  placeholder="Tell us about your specific needs or any questions you have..."
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Form Navigation -->
          <div class="mt-8 flex justify-between">
            <button
              type="button"
              id="prev-step"
              class="hidden px-6 py-3 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Previous
            </button>
            <button
              type="button"
              id="next-step"
              class="ml-auto px-6 py-3 bg-payflo-purple text-white rounded-lg hover:bg-payflo-purple/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Next
            </button>
            <button
              type="submit"
              id="submit-form"
              class="hidden ml-auto px-6 py-3 bg-payflo-purple text-white rounded-lg hover:bg-payflo-purple/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-payflo-purple/20"
            >
              Schedule Demo
            </button>
          </div>
        </form>
      </div>

      <!-- Trust Badges -->
      <div class="mt-12 text-center">
        <p class="text-sm text-gray-600 mb-4">Trusted by leading software companies</p>
        <div class="flex justify-center space-x-8">
          <Icon name="ph:shield-check-duotone" class="h-6 w-6 text-gray-400" />
          <Icon name="ph:lock-key-duotone" class="h-6 w-6 text-gray-400" />
          <Icon name="ph:certificate-duotone" class="h-6 w-6 text-gray-400" />
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  document.addEventListener('astro:page-load', () => {
    const form = document.getElementById('demo-form') as HTMLFormElement | null;
    const steps = document.querySelectorAll<HTMLElement>('.step-content');
    const progressSteps = document.querySelectorAll<HTMLElement>('#progress-steps > div');
    const prevButton = document.getElementById('prev-step') as HTMLButtonElement | null;
    const nextButton = document.getElementById('next-step') as HTMLButtonElement | null;
    const submitButton = document.getElementById('submit-form') as HTMLButtonElement | null;
    let currentStep = 1;

    function updateSteps() {
      if (!prevButton || !nextButton || !submitButton) return;

      steps.forEach((step, index) => {
        if (index + 1 === currentStep) {
          step.classList.remove('hidden');
        } else {
          step.classList.add('hidden');
        }
      });

      progressSteps.forEach((step, index) => {
        const stepCircle = step.querySelector('div');
        if (!stepCircle) return;

        if (index + 1 === currentStep) {
          step.classList.add('bg-payflo-purple/5');
          stepCircle.classList.remove('bg-gray-200', 'text-gray-600');
          stepCircle.classList.add('bg-payflo-purple', 'text-white');
        } else if (index + 1 < currentStep) {
          step.classList.add('bg-payflo-purple/5');
          stepCircle.classList.remove('bg-gray-200', 'text-gray-600');
          stepCircle.classList.add('bg-payflo-purple', 'text-white');
        } else {
          step.classList.remove('bg-payflo-purple/5');
          stepCircle.classList.add('bg-gray-200', 'text-gray-600');
          stepCircle.classList.remove('bg-payflo-purple', 'text-white');
        }
      });

      prevButton.style.display = currentStep === 1 ? 'none' : 'block';
      nextButton.style.display = currentStep === 3 ? 'none' : 'block';
      submitButton.style.display = currentStep === 3 ? 'block' : 'none';
    }

    if (prevButton) {
      prevButton.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep--;
          updateSteps();
        }
      });
    }

    if (nextButton) {
      nextButton.addEventListener('click', () => {
        if (currentStep < 3) {
          currentStep++;
          updateSteps();
        }
      });
    }

    if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        // Here you would typically send the form data to your backend
        alert('Thanks for scheduling a demo! This is a demo, so no actual booking was made.');
      });
    }

    // Form validation
    function validateStep(step: number): boolean {
      if (step === 1) {
        const company = (document.getElementById('company') as HTMLInputElement)?.value;
        const website = (document.getElementById('website') as HTMLInputElement)?.value;
        const companySize = (document.getElementById('company-size') as HTMLSelectElement)?.value;
        const industry = (document.getElementById('industry') as HTMLSelectElement)?.value;
        
        if (!company || !website || !companySize || !industry) {
          const missingFields = [];
          if (!company) missingFields.push('Company Name');
          if (!website) missingFields.push('Company Website');
          if (!companySize) missingFields.push('Company Size');
          if (!industry) missingFields.push('Industry');
          
          alert(`Please fill in the following required fields:\n${missingFields.join('\n')}`);
          return false;
        }
        
        // Validate website URL
        try {
          new URL(website);
        } catch {
          alert('Please enter a valid website URL (e.g., https://example.com)');
          return false;
        }
        
        return true;
      }
      
      if (step === 2) {
        const firstName = (document.getElementById('first-name') as HTMLInputElement)?.value;
        const lastName = (document.getElementById('last-name') as HTMLInputElement)?.value;
        const email = (document.getElementById('work-email') as HTMLInputElement)?.value;
        const jobTitle = (document.getElementById('job-title') as HTMLInputElement)?.value;
        
        if (!firstName || !lastName || !email || !jobTitle) {
          const missingFields = [];
          if (!firstName) missingFields.push('First Name');
          if (!lastName) missingFields.push('Last Name');
          if (!email) missingFields.push('Work Email');
          if (!jobTitle) missingFields.push('Job Title');
          
          alert(`Please fill in the following required fields:\n${missingFields.join('\n')}`);
          return false;
        }
        
        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert('Please enter a valid work email address');
          return false;
        }
        
        return true;
      }
      
      if (step === 3) {
        const selectedDate = document.querySelector('[data-date].border-payflo-purple');
        const timezone = (document.getElementById('timezone') as HTMLSelectElement)?.value;
        
        if (!selectedDate || !timezone) {
          const missingFields = [];
          if (!selectedDate) missingFields.push('Preferred Demo Date');
          if (!timezone) missingFields.push('Timezone');
          
          alert(`Please fill in the following required fields:\n${missingFields.join('\n')}`);
          return false;
        }
        
        return true;
      }
      
      return true;
    }

    // Next button click handler
    if (nextButton) {
      nextButton.addEventListener('click', () => {
        if (validateStep(currentStep)) {
          currentStep++;
          updateSteps();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    }

    // Previous button click handler
    if (prevButton) {
      prevButton.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep--;
          updateSteps();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    }

    // Form submission handler
    if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        if (validateStep(currentStep)) {
          // Here you would typically send the form data to your backend
          alert('Thanks for scheduling a demo! This is a demo, so no actual booking was made.');
          form.reset();
          currentStep = 1;
          updateSteps();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    }

    // Initialize dropdowns with native select behavior
    const dropdowns = document.querySelectorAll('select');
    dropdowns.forEach(dropdown => {
      dropdown.addEventListener('change', () => {
        const selectedOption = dropdown.options[dropdown.selectedIndex];
        if (selectedOption.value) {
          dropdown.classList.add('text-gray-900');
        } else {
          dropdown.classList.remove('text-gray-900');
        }
      });
    });

    // Date selection
    const dateButtons = document.querySelectorAll<HTMLButtonElement>('[data-date]');
    dateButtons.forEach(button => {
      button.addEventListener('click', () => {
        dateButtons.forEach(btn => {
          btn.classList.remove('border-payflo-purple', 'bg-payflo-purple/5');
        });
        button.classList.add('border-payflo-purple', 'bg-payflo-purple/5');
      });
    });
  });
</script>

<style>
  /* Custom styles for form elements */
  select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    appearance: none;
  }
</style>
